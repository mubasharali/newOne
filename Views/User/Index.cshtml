@model IEnumerable<Inspinia_MVC5_SeedProject.Models.AspNetUser>

@{
    ViewBag.Title = "Index";
}

@* replaced email by name *@
<input type="hidden" value="@ViewBag.id" id="userId" />
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Profile</h2>
        <ol class="breadcrumb">
            <li class="active">
                <strong>Profile</strong>
            </li>
            
        </ol>
    </div>
</div>

@*<div data-bind="foreach:showProfile">
    <div data-bind="text:UserName">

    </div>
    <div data-bind="text:Email"></div>
    <form action="#">
        <input type="file" />
        <input type="submit" />
    </form>
</div>*@

<div class="wrapper wrapper-content animated fadeInRight" id="profile" >
   
    <div class="row m-b-lg m-t-lg" data-bind="with:showProfile">
        <div class="col-md-5">

            <div class="profile-image">
                <img data-bind="attr:{src:dpLink}" class="img-circle circle-border m-b-md" alt="profile">
            </div>
            <div class="profile-info">
                <div class="">
                    <div>
                        <h2 class="no-margins" data-bind="text:name"></h2>(<span data-bind="text:isOnline"></span> @*<span data-bind="if:isOnline()"><i class="fa fa-circle text-navy"></i> online</span>
                        <span data-bind="if:!isOnline()"><i class="fa fa-circle text-warning"></i> offline</span>*@)
                        <h4 data-bind="text:shortAbout"></h4>
                        <small>
                            <button class="btn btn-sm" data-bind="visible: loginUserId != id,click:function(){ return addFriend(id)} " style="margin-bottom:1px"><span data-bind="visible:!isFriend()">Add Friend</span><span data-bind="visible:isFriend">UnFriend</span></button> 
                            &nbsp;<button class="btn btn-sm" data-bind="visible: loginUserId != id,click:function(){ return sendMessage(id,name)}" style="margin-bottom:1px">Send message</button> &nbsp;<button data-bind="visible: loginUserId != id" style="margin-bottom:1px" class="btn btn-sm">Follow</button>
                            <button><a class="btn btn-sm" data-bind="visible: loginUserId == id,attr:{href:'/User/Profile/'+ id}" style="margin-bottom:1px">Edit Profile</a></button>
                        </small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <table class="table small m-b-xs">
                <tbody>
                    <tr>
                        <td>
                            From: <strong data-bind="text:city"></strong>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Email: <strong data-bind="text:UserName"></strong>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            phone number: <strong data-bind="text:phoneNumber"></strong>
                        </td>

                    </tr>
                    <tr>
                        <td>
                            Date of birth: <strong data-bind="text:dateOfBirth"></strong>  &nbsp; Gender: <strong data-bind="text:gender"></strong>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-offset-1 col-md-3">
            <table class="table small m-b-xs">
                <tbody>
                    <tr>
                        <td>
                            <strong>142</strong> Active ads
                        </td>
                        <td>
                            <strong>22</strong> Followers
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <strong>61</strong> saved ads
                        </td>
                        <td>
                            <strong>54</strong> Pages
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>154</strong> Questions
                        </td>
                        <td>
                            <strong>32</strong> Answers
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
       
    </div>

    @*<div class="row">

        <div class="col-lg-3" >
            <div class="ibox">
                <div class="ibox-content">
                    <ul class="list-group clear-list m-t">
                        <li class="list-group-item fist-item">
                            Active ads
                        </li>
                        <li class="list-group-item">
                            Save ads
                        </li>
                        <li data-bind="click:openProfile,visible:loginUserId == id" class="list-group-item">
                            Edit profile
                        </li>
                        <li class="list-group-item">
                            Questions asked
                        </li>
                        <li class="list-group-item">
                            Answers
                        </li>
                        <li class="list-group-item">
                            Comments
                        </li>
                    </ul>
                </div>
            </div>
                    <div class="ibox">
                        <div class="ibox-content">
                            <h3>About Alex Smith</h3>

                            <p class="small">
                                There are many variations of passages of Lorem Ipsum available, but the majority have
                                suffered alteration in some form, by injected humour, or randomised words which don't.
                                <br />
                                <br />
                                If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't
                                anything embarrassing
                            </p>

                            <p class="small font-bold">
                                <span><i class="fa fa-circle text-navy"></i> Online status</span>
                            </p>

                        </div>
                    </div>

                    <div class="ibox">
                        <div class="ibox-content">
                            <h3>Followers and friends</h3>
                            <p class="small">
                                If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't
                                anything embarrassing
                            </p>
                            <div class="user-friends">
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a3.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a1.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a2.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a4.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a5.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a6.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a7.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a8.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a2.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a1.jpg"></a>
                            </div>
                        </div>
                    </div>

                    <div class="ibox">
                        <div class="ibox-content">
                            <h3>Personal friends</h3>
                            <ul class="list-unstyled file-list">
                                <li><a href=""><i class="fa fa-file"></i> Project_document.docx</a></li>
                                <li><a href=""><i class="fa fa-file-picture-o"></i> Logo_zender_company.jpg</a></li>
                                <li><a href=""><i class="fa fa-stack-exchange"></i> Email_from_Alex.mln</a></li>
                                <li><a href=""><i class="fa fa-file"></i> Contract_20_11_2014.docx</a></li>
                                <li><a href=""><i class="fa fa-file-powerpoint-o"></i> Presentation.pptx</a></li>
                                <li><a href=""><i class="fa fa-file"></i> 10_08_2015.docx</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="ibox">
                        <div class="ibox-content">
                            <h3>Private message</h3>

                            <p class="small">
                                Send private message to Alex Smith
                            </p>

                            <div class="form-group">
                                <label>Subject</label>
                                <input type="name" class="form-control" placeholder="Message subject">
                            </div>
                            <div class="form-group">
                                <label>Message</label>
                                <textarea class="form-control" placeholder="Your message" rows="3"></textarea>
                            </div>
                            <button class="btn btn-primary btn-block">Send</button>

                        </div>
                    </div>

                </div>

                <div class="col-lg-5">

                    <div class="social-feed-box">

                        <div class="pull-right social-action dropdown">
                            <button data-toggle="dropdown" class="dropdown-toggle btn-white">
                                <i class="fa fa-angle-down"></i>
                            </button>
                            <ul class="dropdown-menu m-t-xs">
                                <li><a href="#">Config</a></li>
                            </ul>
                        </div>
                        <div class="social-avatar">
                            <a href="" class="pull-left">
                                <img alt="image" src="~/Images/a1.jpg">
                            </a>
                            <div class="media-body">
                                <a href="#">
                                    Andrew Williams
                                </a>
                                <small class="text-muted">Today 4:21 pm - 12.06.2014</small>
                            </div>
                        </div>
                        <div class="social-body">
                            <p>
                                Many desktop publishing packages and web page editors now use Lorem Ipsum as their
                                default model text, and a search for 'lorem ipsum' will uncover many web sites still
                                in their infancy. Packages and web page editors now use Lorem Ipsum as their
                                default model text.
                            </p>

                            <div class="btn-group">
                                <button class="btn btn-white btn-xs"><i class="fa fa-thumbs-up"></i> Like this!</button>
                                <button class="btn btn-white btn-xs"><i class="fa fa-comments"></i> Comment</button>
                                <button class="btn btn-white btn-xs"><i class="fa fa-share"></i> Share</button>
                            </div>
                        </div>
                        <div class="social-footer">
                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a1.jpg">
                                </a>
                                <div class="media-body">
                                    <a href="#">
                                        Andrew Williams
                                    </a>
                                    Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words.
                                    <br />
                                    <a href="#" class="small"><i class="fa fa-thumbs-up"></i> 26 Like this!</a> -
                                    <small class="text-muted">12.06.2014</small>
                                </div>
                            </div>

                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a2.jpg">
                                </a>
                                <div class="media-body">
                                    <a href="#">
                                        Andrew Williams
                                    </a>
                                    Making this the first true generator on the Internet. It uses a dictionary of.
                                    <br />
                                    <a href="#" class="small"><i class="fa fa-thumbs-up"></i> 11 Like this!</a> -
                                    <small class="text-muted">10.07.2014</small>
                                </div>
                            </div>

                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a3.jpg">
                                </a>
                                <div class="media-body">
                                    <textarea class="form-control" placeholder="Write comment..."></textarea>
                                </div>
                            </div>

                        </div>

                    </div>

                    <div class="social-feed-box">

                        <div class="pull-right social-action dropdown">
                            <button data-toggle="dropdown" class="dropdown-toggle btn-white">
                                <i class="fa fa-angle-down"></i>
                            </button>
                            <ul class="dropdown-menu m-t-xs">
                                <li><a href="#">Config</a></li>
                            </ul>
                        </div>
                        <div class="social-avatar">
                            <a href="" class="pull-left">
                                <img alt="image" src="~/Images/a6.jpg">
                            </a>
                            <div class="media-body">
                                <a href="#">
                                    Andrew Williams
                                </a>
                                <small class="text-muted">Today 4:21 pm - 12.06.2014</small>
                            </div>
                        </div>
                        <div class="social-body">
                            <p>
                                Many desktop publishing packages and web page editors now use Lorem Ipsum as their
                                default model text, and a search for 'lorem ipsum' will uncover many web sites still
                                in their infancy. Packages and web page editors now use Lorem Ipsum as their
                                default model text.
                            </p>
                            <p>
                                Lorem Ipsum as their
                                default model text, and a search for 'lorem ipsum' will uncover many web sites still
                                in their infancy. Packages and web page editors now use Lorem Ipsum as their
                                default model text.
                            </p>
                            <img src="~/Images/gallery/3.jpg" class="img-responsive">
                            <div class="btn-group">
                                <button class="btn btn-white btn-xs"><i class="fa fa-thumbs-up"></i> Like this!</button>
                                <button class="btn btn-white btn-xs"><i class="fa fa-comments"></i> Comment</button>
                                <button class="btn btn-white btn-xs"><i class="fa fa-share"></i> Share</button>
                            </div>
                        </div>
                        <div class="social-footer">
                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a1.jpg">
                                </a>
                                <div class="media-body">
                                    <a href="#">
                                        Andrew Williams
                                    </a>
                                    Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words.
                                    <br />
                                    <a href="#" class="small"><i class="fa fa-thumbs-up"></i> 26 Like this!</a> -
                                    <small class="text-muted">12.06.2014</small>
                                </div>
                            </div>

                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a2.jpg">
                                </a>
                                <div class="media-body">
                                    <a href="#">
                                        Andrew Williams
                                    </a>
                                    Making this the first true generator on the Internet. It uses a dictionary of.
                                    <br />
                                    <a href="#" class="small"><i class="fa fa-thumbs-up"></i> 11 Like this!</a> -
                                    <small class="text-muted">10.07.2014</small>
                                </div>
                            </div>

                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a8.jpg">
                                </a>
                                <div class="media-body">
                                    <a href="#">
                                        Andrew Williams
                                    </a>
                                    Making this the first true generator on the Internet. It uses a dictionary of.
                                    <br />
                                    <a href="#" class="small"><i class="fa fa-thumbs-up"></i> 11 Like this!</a> -
                                    <small class="text-muted">10.07.2014</small>
                                </div>
                            </div>

                            <div class="social-comment">
                                <a href="" class="pull-left">
                                    <img alt="image" src="~/Images/a3.jpg">
                                </a>
                                <div class="media-body">
                                    <textarea class="form-control" placeholder="Write comment..."></textarea>
                                </div>
                            </div>

                        </div>

                    </div>




                </div>
                <div class="col-lg-4 m-b-lg">
                    <div id="vertical-timeline" class="vertical-container light-timeline no-margins">
                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon navy-bg">
                                <i class="fa fa-briefcase"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Meeting</h2>
                                <p>
                                    Conference on the sales results for the previous year. Monica please examine sales trends in marketing and products. Below please find the current status of the sale.
                                </p>
                                <a href="#" class="btn btn-sm btn-primary"> More info</a>
                                <span class="vertical-date">
                                    Today <br>
                                    <small>Dec 24</small>
                                </span>
                            </div>
                        </div>

                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon blue-bg">
                                <i class="fa fa-file-text"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Send documents to Mike</h2>
                                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since.</p>
                                <a href="#" class="btn btn-sm btn-success"> Download document </a>
                                <span class="vertical-date">
                                    Today <br>
                                    <small>Dec 24</small>
                                </span>
                            </div>
                        </div>

                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon lazur-bg">
                                <i class="fa fa-coffee"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Coffee Break</h2>
                                <p>Go to shop and find some products. Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's. </p>
                                <a href="#" class="btn btn-sm btn-info">Read more</a>
                                <span class="vertical-date"> Yesterday <br><small>Dec 23</small></span>
                            </div>
                        </div>

                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon yellow-bg">
                                <i class="fa fa-phone"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Phone with Jeronimo</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Iusto, optio, dolorum provident rerum aut hic quasi placeat iure tempora laudantium ipsa ad debitis unde? Iste voluptatibus minus veritatis qui ut.</p>
                                <span class="vertical-date">Yesterday <br><small>Dec 23</small></span>
                            </div>
                        </div>

                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon navy-bg">
                                <i class="fa fa-comments"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Chat with Monica and Sandra</h2>
                                <p>Web sites still in their infancy. Various versions have evolved over the years, sometimes by accident, sometimes on purpose (injected humour and the like). </p>
                                <span class="vertical-date">Yesterday <br><small>Dec 23</small></span>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
            <div class="ibox float-e-margins">
                <div class="ibox-title  back-change">
                    <h5>Image cropper <small>http://fengyuanchen.github.io/cropper/</small></h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li>
                                <a href="#">Config option 1</a>
                            </li>
                            <li>
                                <a href="#">Config option 2</a>
                            </li>
                        </ul>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <p>
                        Crop image
                    </p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="image-crop">
                                <img src="~/Images/p3.jpg">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h4>Preview image</h4>
                            <div class="img-preview img-preview-sm"></div>
                            <h4>&nbsp;</h4>
                            <div class="btn-group">
                                <form action="/User/saveProfilePic" method="post" id="setProfilePic" enctype="multipart/form-data">
                                    <label title="Upload image file" for="inputImage" class="btn btn-primary">

                                        <input type="file" accept="image/*" name="file" id="inputImage" class="hide">
                                        Upload new image
                                        <input type="submit" style="visibility:hidden" />

                                    </label>
                                </form>
                                <button id="setProfilePicBtn" class="btn btn-primary">Set as profile picture</button>
                            </div>
                            <h4>Other options</h4>
                            <div class="btn-group">
                                <button class="btn btn-white" id="zoomIn" type="button">Zoom In</button>
                                <button class="btn btn-white" id="zoomOut" type="button">Zoom Out</button>
                                <button class="btn btn-white" id="rotateLeft" type="button">Rotate Left</button>
                                <button class="btn btn-white" id="rotateRight" type="button">Rotate Right</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>*@
        </div>
@section Styles {

    @Styles.Render("~/plugins/toastrStyles")
@Styles.Render("~/plugins/imagecropperStyles")
}
@Html.Partial("/Views/Shared/_Chat.cshtml")
@Html.Partial("~/Views/Shared/_UserLogin.cshtml")
@section Scripts{
    @Scripts.Render("~/plugins/toastr")
@Scripts.Render("~/plugins/imagecropper")
<script src="~/Scripts/jquery.timeago.js"></script>
<script src="~/Scripts/knockout-3.3.0.js"></script>
<script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
<script src="~/signalr/hubs"></script>
<script src="~/Scripts/app/chat.js"></script>
<script src="~/Scripts/UserLogin.js"></script>
    <script>
        function profile(data) {
            var self = this;
            data = data || {};
            self.id = data.Id;
            self.UserName = data.UserName;
            self.city = data.city;
            self.gender = data.gender;
            self.dateOfBirth = "";
            if (data.dateOfBirth != null) {
                self.dateOfBirth = data.dateOfBirth.split("T")[0];
            }
            self.name = data.Email;
            self.phoneNumber = data.phoneNumber;
            self.hideEmail = data.hideEmail;
            self.hidePhoneNumber = data.hidePhoneNumber;
            self.dpExtension = data.dpExtension;
            self.dpLink = '/Images/Users/p' + self.id + self.dpExtension;
            self.shortAbout = data.shortAbout;
            self.longAbout = data.longAbout;
            self.lastSeen = data.lastSeen;
            self.reputation = data.reputation;
            self.since = data.since;
            self.isFriend = ko.observable(data.isFriend);
            self.addFriend = function (id) {
                if (self.loginUserId) {
                    if (self.isFriend()) {
                        self.unFriend(id);
                    } else {
                        self.isFriend(true);
                        $.ajax({
                            url: '/api/User/AddFriend?id=' + id,
                            dataType: "json",
                            contentType: "application/json",
                            cache: false,
                            type: 'POST',
                            success: function (data) {
                                //self.isFriend(true);
                            },
                            error: function () {
                                self.isFriend(false);
                                toastr.error("failed to add friend. Please refresh page and try again", "Error");
                            }
                        })
                    }
                }
            }
            self.unFriend = function (id) {
                self.isFriend(false);
                $.ajax({
                    url: '/api/User/UnFriend?id=' + id,
                    dataType: "json",
                    contentType: "application/json",
                    cache: false,
                    type: 'POST',
                    success: function (data) {
                        //self.isFriend(false);
                    },
                    error: function () {
                        self.isFriend(true);
                        toastr.error("failed to unFriend. Please refresh page and try again", "Error");
                    }
                })
            }

            self.sendMessage = function (id, name) {
                sendMessageTo(id);
                sendMessgeToName(name);
                console.log("Message will be sent to : " + name);
                $(".open-small-chat").trigger('click');

            }

            self.loginUserId = data.loginUserId || "";
            self.age = getAge(self.dateOfBirth);
            self.isUserOnline = function (id) {

            }
            function getAge(dateString) {
                var today = new Date();
                var birthDate = new Date(dateString);
                birthDate = new Date(Date.parse(birthDate, "MM/dd/yyyy"));
                var age = today.getFullYear() - birthDate.getFullYear();
                var m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            }
            self.calculateAge = function () {
                self.dateOfBirth = new Date(self.dateOfBirth);
                var today = new Date();
                self.age = Math.floor((today - self.dateOfBirth) / (365.25 * 24 * 60 * 60 * 1000));
            }
            self.openProfile = function () {
                var userId = $("#userId").val();
                window.location.href = "/User/Profile/" + userId;
            }
        }
        function viewModel() {
            ChatViewModel();
            AccountViewModel();
            
            var self = this;
            self.showProfile = ko.observable();
            
            self.openProfile = function () {
                var userId = $("#userId").val();
                window.location.href = "/User/Profile/" + userId;
            }

            //online users
            //var userId = $("#userId").val();
            //self.onlineUsersHub = $.connection.onlineUsers;
            //self.onlineUsers = ko.observableArray();
            //self.onlineUsersHub.client.showConnected = function (connectionId) {
            //    var mape = $.map(connectionId, function (item) { return item });
            //    self.onlineUsers(mape);
            //    console.log("hi i am here");
            //}
            
           

            self.loadProfile = function () {
                var userId = $("#userId").val();
                $.ajax({
                    url: '/api/User/GetUser/' + userId,
                    dataType: "json",
                    contentType: "application/json",
                    cache: false,
                    type: 'GET',
                    success: function (data) {
                       // var mape = $.map(data, function (item) { return new profile(item); });
                        self.showProfile(new profile(data));
                    },
                    error: function () {
                        toastr.error("failed to load profile", "Error");
                    }
                })
            }
            self.loadProfile();
            return self;
        }
        function getTimeAgo(varDate) {
            if (varDate) {
                return $.timeago(varDate.toString().slice(-1) == 'Z' ? varDate : varDate + 'Z');
            }
            else {
                return '';
            }
        }
        $(function () {
            $('#setProfilePicBtn').prop('disabled', true);
            var $image = $(".image-crop > img")
            $($image).cropper({
                aspectRatio: 1.618,
                preview: ".img-preview",
                done: function (data) {
                    //toastr.info("fone");
                    $('#setProfilePicBtn').prop('disabled', false);
                }
            });

            var $inputImage = $("#inputImage");
            if (window.FileReader) {
                $inputImage.change(function () {
                    var fileReader = new FileReader(),
                            files = this.files,
                            file;

                    if (!files.length) {
                        return;
                    }

                    file = files[0];

                    if (/^image\/\w+$/.test(file.type)) {
                        fileReader.readAsDataURL(file);
                        fileReader.onload = function () {
                            $inputImage.val("");
                            $image.cropper("reset", true).cropper("replace", this.result);
                        };
                    } else {
                        showMessage("Please choose an image file.");
                    }
                });
            } else {
                $inputImage.addClass("hide");
            }

            $("#setProfilePicBtn").click(function () {
                //window.open($image.cropper("getDataURL"));
                $("#setProfilePic").submit();
                toastr.info("Your profile picture is changed successfully! Please refresh page to see changes");
            });

            $("#zoomIn").click(function () {
                $image.cropper("zoom", 0.1);
            });

            $("#zoomOut").click(function () {
                $image.cropper("zoom", -0.1);
            });

            $("#rotateLeft").click(function () {
                $image.cropper("rotate", 45);
            });

            $("#rotateRight").click(function () {
                $image.cropper("rotate", -45);
            });

            $("#setDrag").click(function () {
                $image.cropper("setDragMode", "crop");
            });
            $.connection.hub.start().done();
            //   ko.applyBindings(new viewModel(), document.getElementById("profile"));
           // ChatViewModel();
            ko.applyBindings(new viewModel());
            //  ko.applyBindings(new ChatViewModel(), document.getElementById("chatViewModel"));
            
        });
    </script>
}



